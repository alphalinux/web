<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Sharing a Disk With HP Tru64</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="The aboot Loader"
HREF="srm-aboot.html"><LINK
REL="NEXT"
TITLE="Installation of Distributions"
HREF="srm-distributions.html"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="srm-aboot.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="srm-distributions.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="SRM-SHARINGWITHDEC"
>Sharing a Disk With <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
></A
></H1
><P
>Unfortunately, <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> doesn't know anything about Linux, so sharing
a single disk between the two OSes is not entirely trivial.  However,
it is not a difficult task if you heed the tips in this section.  The
section assumes you are using <VAR
CLASS="LITERAL"
>aboot</VAR
> version 0.5 or newer.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN724"
>Partitioning the disk</A
></H2
><P
>First and foremost: <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>never</I
></SPAN
> use any of the Linux partitioning
programs (<VAR
CLASS="LITERAL"
>minlabel</VAR
> or <VAR
CLASS="LITERAL"
>fdisk</VAR
>) on a disk that is also
used by <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
>.  The Linux <VAR
CLASS="LITERAL"
>minlabel</VAR
> program uses the same
partition table format as <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> <VAR
CLASS="LITERAL"
>disklabel</VAR
>, but there are
some incompatibilities in the data that <VAR
CLASS="LITERAL"
>minlabel</VAR
> fills in, so
<SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> will simply refuse to accept a partition table generated by
<VAR
CLASS="LITERAL"
>minlabel</VAR
>.  To setup a Linux <VAR
CLASS="LITERAL"
>ext2</VAR
> partition under <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
>,
you'll have to change the disktab entry for your disk.  For the
purpose of this discussion, let's assume that you have an rz26 disk (a
common 1GB drive) on which you want to install Linux.  The disktab
entry under <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> v3.2 looks like this (see file
<TT
CLASS="FILENAME"
>/etc/disktab</TT
>):

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>rz26|RZ26|DEC RZ26 Winchester:\
        :ty=winchester:dt=SCSI:ns#57:nt#14:nc#2570:\
        :oa#0:pa#131072:ba#8192:fa#1024:\
        :ob#131072:pb#262144:bb#8192:fb#1024:\
        :oc#0:pc#2050860:bc#8192:fc#1024:\
        :od#393216:pd#552548:bd#8192:fd#1024:\
        :oe#945764:pe#552548:be#8192:fe#1024:\
        :of#1498312:pf#552548:bf#8192:ff#1024:\
        :og#393216:pg#819200:bg#8192:fg#1024:\
        :oh#1212416:ph#838444:bh#8192:fh#1024:</PRE
></TD
></TR
></TABLE
>&#13;</P
><P
>The interesting fields here are <VAR
CLASS="LITERAL"
>o</VAR
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>?</I
></SPAN
>, and
<VAR
CLASS="LITERAL"
>p</VAR
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>?</I
></SPAN
>, where <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>?</I
></SPAN
> is a letter in the range
<VAR
CLASS="LITERAL"
>a</VAR
>-<VAR
CLASS="LITERAL"
>h</VAR
> (first through 8-th partition).  The <VAR
CLASS="LITERAL"
>o</VAR
>
value gives the starting offset of the partition (in sectors) and the
<VAR
CLASS="LITERAL"
>p</VAR
> value gives the size of the partition (also in sectors).
See <VAR
CLASS="LITERAL"
>disktab</VAR
>(4) for more info.  Note that <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> likes to
define overlapping partitions.  For the entry above, the partition
layout looks like this (you can verify this by adding up the various
<VAR
CLASS="LITERAL"
>o</VAR
> and <VAR
CLASS="LITERAL"
>p</VAR
> values):

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>  a    	b      	  d    	      e	     	  f
|---|-------|-----------|-----------|-----------|

                        c
|-----------------------------------------------|

                     g                 h
            |-----------------|-----------------|</PRE
></TD
></TR
></TABLE
> &#13;</P
><P
><SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> insists that partition <VAR
CLASS="LITERAL"
>a</VAR
> starts at offset 0 and that
partition <VAR
CLASS="LITERAL"
>c</VAR
> spans the entire disk.  Other than that, you can
setup the partition table any way you like.</P
><P
>Let's suppose you have <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> using partition <VAR
CLASS="LITERAL"
>g</VAR
> and want to
install Linux on partition <VAR
CLASS="LITERAL"
>h</VAR
> with partition <VAR
CLASS="LITERAL"
>b</VAR
> being a
(largish) swap partition.  To get this layout without destroying the
existing <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> partition, you need to set the partition types
explicitly.  You can do this by adding a <VAR
CLASS="LITERAL"
>t</VAR
> field for each
partition.  In our case, we add the following line to the above
disktab entry.

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>	:ta=unused:tb=swap:tg=4.2BSD:th=resrvd8:</PRE
></TD
></TR
></TABLE
>&#13;</P
><P
>Now why do we mark partition <VAR
CLASS="LITERAL"
>h</VAR
> as "reservd8" instead of "ext2"?
Well, <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> doesn't know about Linux.  It so happens that partition
type "ext2" corresponds to a numeric value of 8, and <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> uses the
string "reservd8" for that value.  Thus, in <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> speak, "reservd8"
means "ext2".  OK, this was the hard part.  Now we just need to
install the updated disktab entry on the disk.  Let's assume the disk
has SCSI id 5.  In this case, we'd do:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
># disklabel -rw /dev/rrz5c rz26</PRE
></TD
></TR
></TABLE
>&#13;</P
><P
>You can verify that everything is all right by reading back the
disklabel with <B
CLASS="COMMAND"
>disklabel -r /dev/rrz5c</B
>.  At this point, you
may want to reboot <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> and make sure the existing <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
>
partition is still alive and well.  If that is the case, you can shut
down the machine and start with the Linux installation.  Be sure to
skip the disk partitioning step during the install.  Since we already
installed a good partition table, you should be able to proceed and
select the 8th partition as the Linux root partition and the 2nd
partition as the swap partition.  If the disk is, say, the second SCSI
disk in the machine, then the device name for these partitions would
be <TT
CLASS="FILENAME"
>/dev/sdb8</TT
> and <TT
CLASS="FILENAME"
>/dev/sdb2</TT
>,
respectively (note that
Linux uses letters to name the drives and numbers to name the
partitions, which is exactly reversed from what <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> does; the
Linux scheme makes more sense, of course ;-).</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN782"
>Installing <VAR
CLASS="LITERAL"
>aboot</VAR
></A
></H2
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>First big caveat</I
></SPAN
>: with the SRM firmware, you can boot one and
only one operating system per disk.  For this reason, it is generally
best to have at least two SCSI disks in a machine that you want to
dual-boot between Linux and <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
>.  Of course, you could also boot
Linux from a floppy if speed doesn't matter or over the network, if
you have a <VAR
CLASS="LITERAL"
>bootp</VAR
>-capable server.  But in this section we assume
you want to boot Linux from a disk that contains one or more <SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
>
partitions.</P
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Second big caveat</I
></SPAN
>: installing <VAR
CLASS="LITERAL"
>aboot</VAR
> on a disk shared with
<SPAN
CLASS="PRODUCTNAME"
>HP Tru64</SPAN
> renders the first and third partition unusable (since those
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>must</I
></SPAN
> have a starting offset of 0).  For this reason, we recommend
that you change the size of partition <VAR
CLASS="LITERAL"
>a</VAR
> to something that is just
big enough to hold <VAR
CLASS="LITERAL"
>aboot</VAR
> (1MB should be plenty).</P
><P
>Once these two caveats are taken care of, installing <VAR
CLASS="LITERAL"
>aboot</VAR
> is
almost as easy as usual: since partition <VAR
CLASS="LITERAL"
>a</VAR
> and <VAR
CLASS="LITERAL"
>c</VAR
> will
overlap with <VAR
CLASS="LITERAL"
>aboot</VAR
>, we need to tell <VAR
CLASS="LITERAL"
>swriteboot</VAR
> that this is
indeed OK.  We can do this under Linux with a command line of the
following form (again, assuming we're trying to install <VAR
CLASS="LITERAL"
>aboot</VAR
> on
the second SCSI disk):

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
># swriteboot -f1 -f3 /dev/sdb bootlx</PRE
></TD
></TR
></TABLE
>&#13;</P
><P
>The <VAR
CLASS="LITERAL"
>-f1</VAR
> means that we want to force writing 
<TT
CLASS="FILENAME"
>bootlx</TT
> even
though it overlaps with partition 1.  The corresponding applies for
partition 3.</P
><P
>This is it.  You should now be able to shutdown the system and boot
Linux from the harddisk.  In our example, the SRM command line to do
this would be:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>&#62;&#62;&#62; boot dka5 -fi 8/vmlinux.gz -fl root=/dev/sdb8</PRE
></TD
></TR
></TABLE
>&#13;</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="srm-aboot.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="srm-distributions.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>The aboot Loader</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Installation of Distributions</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>